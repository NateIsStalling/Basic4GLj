plugins {
    id "application"
}
apply plugin: "java"

ext {
    javaMainClass = "com.basic4gl.desktop.MainWindow"
}

repositories {
    mavenCentral()
}

application {
    mainClassName = javaMainClass
}

dependencies {
    implementation fileTree(dir: "libs", include: ["*.jar"])

    runtimeOnly project(':library')
    runtimeOnly project(':debugServer')

    implementation project(":runtime")
    implementation project(":compiler")
    implementation project(":library")
    implementation project(":debugProtocol")

//    implementation RSyntaxTextArea

    implementation 'com.formdev:flatlaf:3.0'
    // for FlatDesktop Java 8 backports
    implementation 'com.formdev:flatlaf-extras:3.0'

    // for debugger
    implementation ('com.google.code.gson:gson:2.10')
    implementation ('javax.websocket:javax.websocket-api:1.0')
    implementation ('org.eclipse.jetty.websocket:javax-websocket-client-impl:9.4.49.v20220914')

    testCompile 'junit:junit:4.12'
}

jar {
//    dependsOn (":debugServer:jar")
//    dependsOn (":library:jar")
    from { configurations.default.collect { it.isDirectory() ? it : zipTree(it) } }
    from sourceSets.test.output
    manifest {
        attributes (
            'Main-Class': javaMainClass,
            'Class-Path': configurations.default.files.collect { it.name }.join(' ')
        )
    }
    exclude 'META-INF/.RSA', 'META-INF/.SF','META-INF/*.DSA'
}
//
//task withRuntime(type: "jar"){
//    from sourceSets.all
//
//}
task copyTask() {
    copy {
        from '../samples'
        into 'build/samples'
    }
    copy {
        from 'LICENSES'
        into 'build/LICENSES'
    }
}
//run {
//////    args project(":library").task("jar").archiveFile.get()
////    dependsOn (":library:jar") {
//////        println(project(":library").task("jar").archiveFile.get())
////
//////        args rootProject.ext.get("libraryJarPath")
////    }
//
//    dependsOn (":debugServer:jar")
//    dependsOn (":library:jar") {
//        println(rootProject.ext.get("libraryJarPath"))
//        println(rootProject.ext.get("debugServerJarPath"))
////        run {
//            args rootProject.ext.get("libraryJarPath"),
//                    rootProject.ext.get("debugServerJarPath")
////        }
//    }
//}
//task start {
//    dependsOn (":debugServer:jar")
//    dependsOn (":library:jar") {
//        println(rootProject.ext.get("libraryJarPath"))
//        println(rootProject.ext.get("debugServerJarPath"))
//        run {
//        args rootProject.ext.get("libraryJarPath"),
//            rootProject.ext.get("debugServerJarPath")
//        }
//    }
//}

repositories {
    mavenCentral()
}
